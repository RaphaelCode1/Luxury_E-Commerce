{% extends "base.html" %}

{% block title %}Order #{{ order.order_number }}{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem 0;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1 style="font-size: 2.5rem; font-family: 'Playfair Display', serif;">Order #{{ order.order_number }}</h1>
        <a href="/admin/orders" class="btn btn-secondary">Back to Orders</a>
    </div>

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
        <!-- Order Items -->
        <div style="background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h2 style="margin-bottom: 1.5rem;">Order Items</h2>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid #d4af37;">
                        <th style="text-align: left; padding: 1rem 0;">Product</th>
                        <th style="text-align: left; padding: 1rem 0;">Price</th>
                        <th style="text-align: left; padding: 1rem 0;">Quantity</th>
                        <th style="text-align: left; padding: 1rem 0;">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 1rem 0;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <img src="{{ item.product.image_url or '/static/images/placeholder.jpg' }}" 
                                     alt="{{ item.product.name }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                                <div>
                                    <div style="font-weight: 600;">{{ item.product.name }}</div>
                                    <div style="font-size: 0.9rem; color: #666;">{{ item.product.brand }}</div>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 1rem 0;">KES {{ "{:,.0f}".format(item.price) }}</td>
                        <td style="padding: 1rem 0;">{{ item.quantity }}</td>
                        <td style="padding: 1rem 0;">KES {{ "{:,.0f}".format(item.price * item.quantity) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr style="border-top: 2px solid #d4af37;">
                        <td colspan="3" style="text-align: right; padding: 1rem 0; font-weight: bold;">Total:</td>
                        <td style="padding: 1rem 0; font-weight: bold; color: #d4af37;">KES {{ "{:,.0f}".format(order.total_amount) }}</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <!-- Order Details -->
        <div>
            <div style="background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1.5rem;">Order Details</h2>
                
                <div style="margin-bottom: 1rem;">
                    <label style="font-weight: 600; color: #666;">Status</label>
                    <select id="order-status" data-order-id="{{ order.id }}" 
                            style="width: 100%; padding: 0.8rem; margin-top: 0.5rem; border: 1px solid #ddd; border-radius: 4px;
                                   background: {% if order.status == 'paid' %}#4CAF50{% elif order.status == 'pending' %}#ff9800{% elif order.status == 'delivered' %}#2196F3{% else %}#f44336{% endif %}; 
                                   color: white;">
                        <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
                        <option value="paid" {% if order.status == 'paid' %}selected{% endif %}>Paid</option>
                        <option value="processing" {% if order.status == 'processing' %}selected{% endif %}>Processing</option>
                        <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>Shipped</option>
                        <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Delivered</option>
                        <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                    </select>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="font-weight: 600; color: #666;">Payment Method</label>
                    <p>{{ order.payment_method|upper }}</p>
                </div>

                {% if order.mpesa_receipt %}
                <div style="margin-bottom: 1rem;">
                    <label style="font-weight: 600; color: #666;">M-Pesa Receipt</label>
                    <p style="color: #4CAF50;">{{ order.mpesa_receipt }}</p>
                </div>
                {% endif %}

                <div style="margin-bottom: 1rem;">
                    <label style="font-weight: 600; color: #666;">Order Date</label>
                    <p>{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                </div>
            </div>

            <!-- Customer Information -->
            <div style="background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h2 style="margin-bottom: 1.5rem;">Customer Information</h2>
                
                <div style="margin-bottom: 1rem;">
                    <label style="font-weight: 600; color: #666;">Name</label>
                    <p>{{ order.customer.username if order.customer else 'Guest' }}</p>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="font-weight: 600; color: #666;">Phone</label>
                    <p>{{ order.phone }}</p>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="font-weight: 600; color: #666;">Email</label>
                    <p>{{ order.customer.email if order.customer else 'N/A' }}</p>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="font-weight: 600; color: #666;">Delivery Address</label>
                    <p>{{ order.address }}, {{ order.city }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('order-status')?.addEventListener('change', function() {
    const orderId = this.dataset.orderId;
    const status = this.value;
    
    fetch(`/admin/orders/update-status/${orderId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ status: status })
    })
    .then(response => response.json())
    .then(data => {
        alert('Order status updated!');
    });
});
</script>
{% endblock %}
