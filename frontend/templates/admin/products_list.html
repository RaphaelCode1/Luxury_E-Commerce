{% extends "base.html" %}

{% block title %}Manage Products{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem 0;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1 style="font-size: 2.5rem; font-family: 'Playfair Display', serif;">Manage Products</h1>
        <a href="/admin/products/add" class="btn btn-primary">+ Add New Product</a>
    </div>

    <!-- Filters -->
    <div style="background: #fff; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem;">
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <select id="category-filter" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                <option value="all">All Categories</option>
                <option value="watches">Watches</option>
                <option value="gold">Gold</option>
                <option value="diamond">Diamond</option>
            </select>
            <input type="text" id="search" placeholder="Search products..." 
                   style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; flex: 1;">
            <button onclick="filterProducts()" class="btn btn-primary">Filter</button>
        </div>
    </div>

    <!-- Products Table -->
    <div style="background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid #d4af37;">
                    <th style="text-align: left; padding: 1rem 0;">Image</th>
                    <th style="text-align: left; padding: 1rem 0;">Name</th>
                    <th style="text-align: left; padding: 1rem 0;">Brand</th>
                    <th style="text-align: left; padding: 1rem 0;">Category</th>
                    <th style="text-align: left; padding: 1rem 0;">Price</th>
                    <th style="text-align: left; padding: 1rem 0;">Discount</th>
                    <th style="text-align: left; padding: 1rem 0;">Stock</th>
                    <th style="text-align: left; padding: 1rem 0;">Featured</th>
                    <th style="text-align: left; padding: 1rem 0;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 1rem 0;">
                        <img src="{{ product.image_url or '/static/images/placeholder.jpg' }}" 
                             alt="{{ product.name }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                    </td>
                    <td style="padding: 1rem 0;">{{ product.name }}</td>
                    <td style="padding: 1rem 0;">{{ product.brand }}</td>
                    <td style="padding: 1rem 0;">{{ product.category }}</td>
                    <td style="padding: 1rem 0;">
                        <span style="{% if product.discount %}text-decoration: line-through; color: #999;{% endif %}">
                            KES {{ "{:,.0f}".format(product.price) }}
                        </span>
                        {% if product.discount %}
                        <br><span style="color: #d4af37; font-weight: bold;">KES {{ "{:,.0f}".format(product.price * (1 - product.discount/100)) }}</span>
                        <span style="background: #ff4444; color: white; padding: 0.2rem 0.5rem; border-radius: 3px; font-size: 0.8rem;">-{{ product.discount }}%</span>
                        {% endif %}
                    </td>
                    <td style="padding: 1rem 0;">
                        {% if product.discount %}
                            {{ product.discount }}%
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td style="padding: 1rem 0;">{{ product.stock }}</td>
                    <td style="padding: 1rem 0;">
                        {% if product.featured %}
                        <span style="color: #4CAF50;">✓</span>
                        {% else %}
                        <span style="color: #999;">✗</span>
                        {% endif %}
                    </td>
                    <td style="padding: 1rem 0;">
                        <a href="/admin/products/edit/{{ product.id }}" class="btn btn-secondary" style="padding: 0.3rem 0.8rem;">Edit</a>
                        <button onclick="deleteProduct({{ product.id }})" class="btn" style="background: #dc3545; color: white; padding: 0.3rem 0.8rem;">Delete</button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="9" style="text-align: center; padding: 2rem;">No products found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function filterProducts() {
    const category = document.getElementById('category-filter').value;
    const search = document.getElementById('search').value;
    window.location.href = `/admin/products?category=${category}&search=${search}`;
}

function deleteProduct(id) {
    if (confirm('Are you sure you want to delete this product?')) {
        fetch(`/admin/products/delete/${id}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            location.reload();
        });
    }
}
</script>
{% endblock %}
